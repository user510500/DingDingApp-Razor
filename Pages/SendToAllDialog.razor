@inject ApiService ApiService
@inject DialogService DialogService
@inject NotificationService NotificationService

<RadzenStack Gap="1rem">
    <RadzenFormField Text="消息内容" class="w-100">
        <RadzenTextArea @bind-Value="@messageRequest.Content" Rows="5" class="w-100" />
    </RadzenFormField>

    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem">
        <RadzenButton Text="取消" ButtonStyle="ButtonStyle.Light" Click="@(() => DialogService.Close(false))" />
        <RadzenButton Text="发送" ButtonStyle="ButtonStyle.Primary" Click="@OnSend" />
    </RadzenStack>
</RadzenStack>

@code {
    private SendMessageRequest messageRequest = new();

    private async Task OnSend()
    {
        if (string.IsNullOrWhiteSpace(messageRequest.Content))
        {
            NotificationService.Notify(NotificationSeverity.Warning, "警告", "消息内容不能为空");
            return;
        }

        var response = await ApiService.SendMessageToAllAsync(messageRequest);
        if (response?.Success == true)
        {
            NotificationService.Notify(NotificationSeverity.Success, "成功", "消息发送成功");
            DialogService.Close(true);
        }
        else
        {
            NotificationService.Notify(NotificationSeverity.Error, "错误", response?.Message ?? "消息发送失败");
        }
    }
}

